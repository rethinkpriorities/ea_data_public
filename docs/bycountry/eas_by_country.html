<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.243">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>eas_by_country</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="eas_by_country_files/libs/clipboard/clipboard.min.js"></script>
  <script src="eas_by_country_files/libs/quarto-html/quarto.js"></script>
  <script src="eas_by_country_files/libs/quarto-html/popper.min.js"></script>
  <script src="eas_by_country_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="eas_by_country_files/libs/quarto-html/anchor.min.js"></script>
  <link href="eas_by_country_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="eas_by_country_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="eas_by_country_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="eas_by_country_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="eas_by_country_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script async="" src="https://hypothes.is/embed.js"></script>
  <script src="eas_by_country_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
  <link href="eas_by_country_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
  <script src="eas_by_country_files/libs/datatables-binding-0.20/datatables.js"></script>
  <script src="eas_by_country_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="eas_by_country_files/libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="eas_by_country_files/libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
  <script src="eas_by_country_files/libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
  <link href="eas_by_country_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
  <script src="eas_by_country_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#eas-by-country-understanding-drivers-the-search-for-outliers-and-untapped-markets" id="toc-eas-by-country-understanding-drivers-the-search-for-outliers-and-untapped-markets" class="nav-link active" data-scroll-target="#eas-by-country-understanding-drivers-the-search-for-outliers-and-untapped-markets"> <span class="header-section-number">1</span> EAS by country: understanding drivers, the search for outliers and untapped ‘markets’</a>
<ul class="collapse">
<li><a href="#bring-in-country-level-data-input-by-hand-etc" id="toc-bring-in-country-level-data-input-by-hand-etc" class="nav-link" data-scroll-target="#bring-in-country-level-data-input-by-hand-etc"> <span class="header-section-number">1.1</span> Bring in country level data (input by hand, etc)</a></li>
<li><a href="#further-english-language-features-and-imputation" id="toc-further-english-language-features-and-imputation" class="nav-link" data-scroll-target="#further-english-language-features-and-imputation"> <span class="header-section-number">1.2</span> Further English language features and imputation</a>
<ul class="collapse">
<li><a href="#other-imputation" id="toc-other-imputation" class="nav-link" data-scroll-target="#other-imputation"> <span class="header-section-number">1.2.1</span> Other imputation</a></li>
</ul></li>
</ul></li>
<li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models"> <span class="header-section-number">2</span> Models</a>
<ul class="collapse">
<li><a href="#plotting-predicted-versus-actual-levels-and-largest-outliers" id="toc-plotting-predicted-versus-actual-levels-and-largest-outliers" class="nav-link" data-scroll-target="#plotting-predicted-versus-actual-levels-and-largest-outliers"> <span class="header-section-number">2.1</span> Plotting predicted versus actual levels and largest ‘outliers’</a>
<ul class="collapse">
<li><a href="#linear" id="toc-linear" class="nav-link" data-scroll-target="#linear"> <span class="header-section-number">2.1.1</span> Linear</a></li>
<li><a href="#per-capita-imposing-linearity-in-population" id="toc-per-capita-imposing-linearity-in-population" class="nav-link" data-scroll-target="#per-capita-imposing-linearity-in-population"> <span class="header-section-number">2.1.2</span> Per-capita (imposing linearity in population)</a></li>
<li><a href="#log-log-adding-0.1" id="toc-log-log-adding-0.1" class="nav-link" data-scroll-target="#log-log-adding-0.1"> <span class="header-section-number">2.1.3</span> Log-log (adding 0.1)</a></li>
<li><a href="#exponential-quasi-poisson" id="toc-exponential-quasi-poisson" class="nav-link" data-scroll-target="#exponential-quasi-poisson"> <span class="header-section-number">2.1.4</span> Exponential (Quasi-Poisson)</a></li>
</ul></li>
<li><a href="#table-of-residuals" id="toc-table-of-residuals" class="nav-link" data-scroll-target="#table-of-residuals"> <span class="header-section-number">2.2</span> Table of residuals</a></li>
</ul></li>
<li><a href="#exporting-all-data-and-model-results-to-git-and-gsheets" id="toc-exporting-all-data-and-model-results-to-git-and-gsheets" class="nav-link" data-scroll-target="#exporting-all-data-and-model-results-to-git-and-gsheets"> <span class="header-section-number">3</span> Exporting all data (and model results) to git and Gsheets</a></li>
</ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<section id="eas-by-country-understanding-drivers-the-search-for-outliers-and-untapped-markets" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> EAS by country: understanding drivers, the search for outliers and untapped ‘markets’</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>here <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>filter</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnoodling)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinkpriorities)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(broom,  dplyr, ggplot2,  ggrepel, janitor, kableExtra, readr, tidyr, tidyselect, tidymodels, tidyverse, plotly, DT,  <span class="at">install =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(huxtable)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(modelr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(httr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(viridis, ggsci)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(googlesheets4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="bring-in-country-level-data-input-by-hand-etc" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="bring-in-country-level-data-input-by-hand-etc"><span class="header-section-number">1.1</span> Bring in country level data (input by hand, etc)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"EAs per capita across time - Compiled Dataset.csv"</span>), <span class="at">skip=</span><span class="dv">1</span>, <span class="at">na=</span><span class="fu">c</span>(<span class="st">"N/A"</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Alt: input direct from Google sheets </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#May need authorisation to writeread from RP drive</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scopes =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>,  <span class="at">email =</span> <span class="st">"dreinstein@rethinkpriorities.org"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span><span class="fu">read_sheet</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ss =</span> <span class="st">"https://docs.google.com/spreadsheets/d/1-oTtv71FnMfenXJtHiPwnhh-Za10s46AGmDLp4mnjvY/edit#gid=1909032845"</span>, <span class="at">sheet =</span> <span class="st">"Compiled Dataset"</span>, <span class="at">skip=</span><span class="dv">1</span>,  <span class="at">na=</span><span class="fu">c</span>(<span class="st">"N/A"</span>)) </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(across(matches("GDP|"), as.numeric)) %&gt;% </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(EAspercapita_2018, EAspercapita_2019, EAspercapita_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap_per100k =</span> easpercap<span class="sc">*</span><span class="dv">100</span><span class="sc">*</span><span class="dv">1000</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_easpercap =</span> <span class="fu">log</span>(easpercap),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">eas_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(EAs_2018, EAs_2019, EAs_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_eas_3yr_01 =</span> <span class="fu">log</span>(eas_3yr_avg <span class="sc">+</span> <span class="fl">0.1</span>),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">population_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(Population_2018, Population_2019, Population_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdpppp_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(GDPPPP_2018, GDPPPP_2019, GDPPPP_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdppop_3yr_avg =</span>  gdpppp_3yr_avg<span class="sc">/</span>population_3yr_avg,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_gdppop_3yr_avg =</span> (<span class="fu">log</span>(gdppop_3yr_avg)),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>med_country_gdppop <span class="ot">&lt;-</span> <span class="fu">median</span>(eas_by_country_all<span class="sc">$</span>gdppop_3yr_avg, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdppop_3yr_avg_above_med =</span> gdppop_3yr_avg<span class="sc">*</span>(gdppop_3yr_avg<span class="sc">&gt;</span>med_country_gdppop),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_gdppop_3yr_avg_above_med =</span> log_gdppop_3yr_avg<span class="sc">*</span>(gdppop_3yr_avg<span class="sc">&gt;</span>med_country_gdppop),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="further-english-language-features-and-imputation" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="further-english-language-features-and-imputation"><span class="header-section-number">1.2</span> Further English language features and imputation</h2>
<p>We add the UK Government classification of ‘majority native English speaking’ according to <a href="https://www.northampton.ac.uk/international/english-language-requirements/majority-native-english-speaking-countries/">university websites</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>uk_govt_classified_english_speaking <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"uk_govt_classified_english_speaking.csv"</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">country=</span><span class="fu">tolower</span>(X1)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_uk_english =</span><span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(uk_govt_classified_english_speaking, <span class="at">by=</span><span class="st">"country"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_uk_english =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    country<span class="sc">==</span><span class="st">"united states"</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co">#USA named differently in other data, needed fixing</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    country<span class="sc">==</span><span class="st">"bermuda"</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co">#an obvious omission</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(d_uk_english) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We input a measure of English proficiency by country, from <a href="https://en.wikipedia.org/wiki/EF_English_Proficiency_Index" class="uri">https://en.wikipedia.org/wiki/EF_English_Proficiency_Index</a>, through a <a href="https://www.kaggle.com/datasets/mathurinache/ef-english-proficiency-index?resource=download">Kaggler</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>EF_English_Proficiency_Index <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"EF_English_Proficiency_Index.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"ef_epi_19"</span><span class="ot">=</span> <span class="st">`</span><span class="at">2019 Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country=</span><span class="fu">tolower</span>(Country),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">country =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"mainland china"</span> <span class="sc">~</span> <span class="st">"china"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"russia"</span> <span class="sc">~</span> <span class="st">"russian federation"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"hong kong"</span> <span class="sc">~</span> <span class="st">"hong kong sar china"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> country</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country, ef_epi_19)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our analysis (not shown) arguably suggested that the proficiency measure was the more reasonable one. However, this measure is missing for predominantly-English-speaking countries; we semi-arbitrarily assign these countries a score of 80.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(EF_English_Proficiency_Index, <span class="at">by =</span> <span class="st">"country"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ef_epi_19_adj =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    d_uk_english <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">80</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> ef_epi_19)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target="#callout-1" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Another ‘average’ measure, not used in modeling below
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The two English prevalence/proficiency measures cover different countries, each with many missing values. As a compromise measure, we averaged these two, taking the nonmissing value of one where the other is missing, a feature we call <code>english_av</code>. Where both are missing for a country, we took the average of the above average for the “Cultural Zone” of the country. (Code chunk below).</p>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">english_speakers_pctl =</span> <span class="fu">rank</span>(EnglishSpeakers, <span class="at">ties.method =</span> <span class="fu">c</span>(<span class="st">"average"</span>), <span class="at">na.last=</span><span class="st">"keep"</span>)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(EnglishSpeakers)),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ef_epi_19_pctl =</span> <span class="fu">rank</span>(ef_epi_19, <span class="at">ties.method =</span> <span class="fu">c</span>(<span class="st">"average"</span>), <span class="at">na.last=</span><span class="st">"keep"</span>)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(ef_epi_19)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>eas_by_country_all<span class="sc">$</span>english_av <span class="ot">&lt;-</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowMeans</span>(eas_by_country_all <span class="sc">%&gt;%</span> <span class="fu">select</span>(ef_epi_19_pctl, english_speakers_pctl) <span class="sc">%&gt;%</span> as.matrix, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> <span class="co">#impute to regional average where missing</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CulturalZone) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">english_av_zone =</span> <span class="fu">mean</span>(english_av, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">english_av =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(english_av) <span class="sc">~</span> english_av_zone,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> english_av)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># next take the average of the nonmissing percentiles</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What does the “English proficiency” feature look like?:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, ef_epi_19_adj) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(<span class="at">class =</span> <span class="st">'cell-border stripe'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-1e434aa0f550674d3505" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1e434aa0f550674d3505">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101"],["angola","argentina","australia","austria","barbados","belarus","belgium","bermuda","brazil","bulgaria","burkina faso","cameroon","canada","central african republic","chile","china","colombia","costa rica","croatia","cuba","cyprus","czech republic","democratic republic of the congo","denmark","ecuador","egypt","el salvador","estonia","ethiopia","faroe islands","finland","france","georgia","germany","ghana","greece","guatemala","haiti","hong kong sar china","hungary","iceland","india","ireland","israel","italy","japan","kazakhstan","kenya","latvia","lebanon","lesotho","liberia","lithuania","luxembourg","malaysia","malta","mexico","morocco","myanmar","namibia","netherlands","new zealand","nigeria","norway","oman","pakistan","palestinian territories","papua new guinea","peru","philippines","poland","portugal","qatar","romania","russian federation","rwanda","saudi arabia","senegal","serbia","sierra leone","singapore","slovakia","slovenia","south africa","south korea","spain","sweden","switzerland","taiwan","north macedonia","trinidad and tobago","tunisia","turkey","uganda","united kingdom","united arab emirates","tanzania","uruguay","united states","vietnam","zambia"],[44.54,58.38,80,64.11,80,52.39,63.09,80,50.1,58.97,null,46.28,80,null,52.89,53.44,48.75,57.38,63.07,52.7,null,59.3,null,67.87,46.57,47.11,50.09,58.29,49.64,null,65.34,57.25,50.62,63.77,null,59.87,52.5,null,55.63,61.86,null,55.49,80,null,55.31,51.51,43.83,60.51,56.85,null,null,null,60.11,64.03,58.55,80,48.99,47.19,46,null,70.27,80,58.26,67.93,44.39,51.41,null,null,50.22,60.14,63.76,63.14,46.79,61.36,52.14,null,41.6,null,61.3,null,66.82,58.82,null,65.38,55.04,55.46,68.74,60.23,54.18,null,80,49.04,46.81,null,80,48.19,null,54.08,80,51.57,null]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>country<\/th>\n      <th>ef_epi_19_adj<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>english_plot <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>EnglishSpeakers, <span class="at">y=</span>ef_epi_19_adj, <span class="at">color=</span>d_uk_english) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> country),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding   =</span> <span class="fl">0.3</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">point.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="st">'grey50'</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"English proficiency measure versus 'English Speakers share'"</span>) </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/english_shown-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="other-imputation" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="other-imputation"><span class="header-section-number">1.2.1</span> Other imputation</h3>
<p>We quickly impute all other features (where they are missing) by taking the average for the “Cultural Zone” (relevant for below models: <code>Emancipative</code> and <code>Secular</code>). The data frame with imputed values is called <code>eas_by_country_all_i</code>, the one without imputations is <code>eas_by_country_all</code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#eas_by_country_all_i &lt;- eas_by_country_all %&gt;% </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#labelled::set_variable_labels(.labels = as.list(all_char_labels), .strict=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#imputation where missing</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_i <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CulturalZone) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="fu">median</span>(x, <span class="at">na.rm =</span> T), x)) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="models" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Models</h1>
<p>I typically like to define the ‘key features’ and ‘key outcomes’ up top. I started on this here, but didn’t do it too much.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#key features</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>features_percap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gdppop_3yr_avg"</span>, <span class="st">"gdppop_3yr_avg_above_med"</span>, <span class="st">"d_uk_english"</span>, <span class="st">"ef_epi_19_adj"</span>, <span class="st">"Emancipative"</span>, <span class="st">"Secular"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"population_3yr_avg"</span>, features_percap)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>log_features_percap <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"log_gdppop_3yr_avg"</span>, <span class="st">"d_uk_english"</span>, <span class="st">"ef_epi_19_adj"</span>,  <span class="st">"Emancipative"</span>, <span class="st">"Secular"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>log_features <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"log(population_3yr_avg)"</span>, log_features_percap)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#This makes complete cases only:</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#eas_by_country_all_nomissing &lt;- eas_by_country_all %&gt;%  na.omit(features)</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(eas_by_country_all) <span class="ot">&lt;-</span> eas_by_country_all<span class="sc">$</span>country  </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(eas_by_country_all_i) <span class="ot">&lt;-</span> eas_by_country_all_i<span class="sc">$</span>country  </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Using rownames is an annoying workaround to get labels in graphs later. There's probably a better way.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below, we construct models</p>
<ul>
<li><p>imputed and complete-case-only data,</p></li>
<li><p>with linear, log transformations (adding a small number to avoid dropping 0’s), and exponential (quasi-Poisson) specifications<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p></li>
<li><p>with level and per-capita outcomes (the latter imposes linearity in population).</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model_linear <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, features), .) </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>model_linear_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, features), .) </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#model_log_eapercap &lt;- eas_by_country_all %&gt;%  filter(easpercap&gt;0) %&gt;% lm(make_formula("log_easpercap", log_features_percap), .)  model_log_eapercap_i &lt;- eas_by_country_all_i %&gt;%  filter(easpercap&gt;0) %&gt;% lm(make_formula("log_easpercap", log_features_percap), </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>model_eapercap <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"easpercap_per100k"</span>, features_percap), .)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>model_eapercap_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"easpercap_per100k"</span>, features_percap), .)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>model_log_linear_p1 <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"log_eas_3yr_01"</span>, log_features), .) </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>model_log_linear_p1_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span> <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"log_eas_3yr_01"</span>, log_features), .) </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>model_ea_psn <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span>  <span class="fu">glm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, log_features), <span class="at">family=</span>quasipoisson, <span class="at">data =</span>.) </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>model_ea_psn_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">glm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, log_features), <span class="at">family=</span>quasipoisson, <span class="at">data =</span>.) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We put the coefficients of these models into summary tables below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ea_by_country_all_models_table <span class="ot">&lt;-</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">huxreg</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Linear"</span> <span class="ot">=</span> model_linear, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_linear_i,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Per `100k` capita"</span> <span class="ot">=</span> model_eapercap, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_eapercap_i, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"log EAs + 0.1"</span> <span class="ot">=</span> model_log_linear_p1, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span>  model_log_linear_p1_i,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quasi-Poisson"</span> <span class="ot">=</span> model_ea_psn,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_ea_psn_i) <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_number_format</span>(<span class="at">row=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">col=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">value=</span><span class="st">"%#.2f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">set_bold</span>(<span class="dv">1</span>, everywhere) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_bottom_border</span>(<span class="dv">1</span>, everywhere) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_caption_pos</span>(<span class="st">"top"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_caption</span>(<span class="st">"EAs by country: Models"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_col_width</span>(<span class="fu">c</span>(.<span class="dv">25</span>, <span class="fu">rep</span>(.<span class="dv">13</span>,<span class="dv">8</span>)))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p></p><table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:ea_by_country_all_models_table">
<caption style="caption-side: top; text-align: center;">EAs by country: Models</caption><colgroup><col style="width: 25%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"><col style="width: 13%"></colgroup><tbody><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Linear</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">... imputed</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Per `100k` capita</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">... imputed</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">log EAs + 0.1</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">... imputed</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Quasi-Poisson</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">... imputed</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-5.96&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.62&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.24&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.25 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-14.59 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-14.63 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-12.49 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-15.29 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(90.74)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(66.39)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.17)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.12)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2.13)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.90)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2.67)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2.23)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">population_3yr_avg</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.00)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.00)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">gdppop_3yr_avg</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-302.85&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-861.72&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.21&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.27&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1701.38)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1177.62)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(3.24)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2.21)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">gdppop_3yr_avg_above_med</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">952.23&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">908.39&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.05&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.70&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1378.10)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1022.41)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2.63)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.91)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">d_uk_englishTRUE</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">182.60 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">124.57 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.17&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.08&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.27&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.32&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.03&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(50.27)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(38.68)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.10)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.07)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.66)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.65)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.48)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.45)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">ef_epi_19_adj</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.55&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.17&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.07 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.06 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.06 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.07 **&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.96)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.51)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.00)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.00)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.03)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.03)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.03)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.02)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Emancipative</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">54.65&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">177.92&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.79 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.97 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.19 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.27 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.06 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.42 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(150.59)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(110.53)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.29)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.21)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.92)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.77)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.52)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.41)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Secular</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.97&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-50.13&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.24&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.36&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3.04&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3.55&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-4.13 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-4.21 *&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(147.36)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(113.04)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.28)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.21)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.84)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.87)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.98)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.89)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">log(population_3yr_avg)</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.69 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.61 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.74 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.80 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.09)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.06)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.06)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.05)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">log_gdppop_3yr_avg</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.71 **&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.28 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.16 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.91 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.21)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.13)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.24)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.20)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">65.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">101.00&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">65.00&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">101.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">65.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">101.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">65.00&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">101.00&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">R2</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.42&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.28&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.49&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.48&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.79&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.71&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">logLik</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-368.18&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-561.89&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">38.28&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">71.72&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-86.36&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-149.25&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">AIC</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">754.36&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1141.78&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-60.55&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-127.44&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">188.73&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">314.50&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="9" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</tbody></table>
<p></p>
</div>
</div>
<p><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Next, we add the predicted values to the basic data set (imputed and non), to later make tables of predictions, and residuals, and share that data</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the repetition for both data sets below is rubbish -- I should use 'map' instead</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>add_preds <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_predictions</span>(model_linear, <span class="at">var =</span> <span class="st">"pred_linear"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_linear_i, <span class="at">var =</span> <span class="st">"pred_linear_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_eapercap, <span class="at">var =</span> <span class="st">"pred_eapercap"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_eapercap_i, <span class="at">var =</span> <span class="st">"pred_eapercap_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_log_linear_p1, <span class="at">var =</span> <span class="st">"pred_log_ea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_log_linear_p1_i, <span class="at">var =</span> <span class="st">"pred_log_ea_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_ea_psn, <span class="at">var =</span> <span class="st">"pred_psn"</span>, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_ea_psn_i, <span class="at">var =</span> <span class="st">"pred_psn_i"</span>, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_pred_log_ea =</span> <span class="fu">exp</span>(pred_log_ea),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">exp_pred_log_ea_i =</span> <span class="fu">exp</span>(pred_log_ea_i),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_eapercap_permil =</span> pred_eapercap<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_eapercap_permil_i =</span> pred_eapercap_i<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap_permil =</span> easpercap<span class="sc">*</span><span class="dv">1000</span><span class="sc">*</span><span class="dv">1000</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>add_preds </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  add_preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="plotting-predicted-versus-actual-levels-and-largest-outliers" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="plotting-predicted-versus-actual-levels-and-largest-outliers"><span class="header-section-number">2.1</span> Plotting predicted versus actual levels and largest ‘outliers’</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>devplotopts <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>), </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> country),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding   =</span> <span class="fl">0.3</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">point.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="st">'grey50'</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span><span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">'grey'</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(), </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis</span>(<span class="at">option =</span> <span class="st">"H"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We plot the predicted and actual numbers (or population shares) of EAs for each country, for most of the models. For each, we first plot the ‘complete cases’ only, and then the models with imputed missing values of features.</p>
<p>In each case countries above the grey degree line represent ‘overperformers’ relative to prediction and those below it ‘underperformers’. Note that while these are linear models, we plot on a log scale to make it more visible. This (falsely) suggest that the prediction is not centered, as moving above the line increases more quickly than moving below it decreases.</p>
<p>We color the country dots based on their English prevalence and proficiency score.</p>
<section id="linear" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="linear"><span class="header-section-number">2.1.1</span> Linear</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ea_dev_linear <span class="ot">&lt;-</span> model_linear <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear model, log scales): Predicted, actual, no imputation"</span>) </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_linear-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ea_dev_linear_i <span class="ot">&lt;-</span> model_linear_i <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        devplotopts <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_linear-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the linear model is making some strange predictions, e.g., predicting very high numbers of EAs for small English-speaking/fluent countries. This is may be because the lack of proportionality doesn’t allow population to ‘matter enough.’ We will report on this model a bit less below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>resid_threshold <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>threshold_low <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>threshold_high <span class="ot">&lt;-</span>  <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>resid_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">threshold_low =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">threshold_high =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">residname =</span> .resid) {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.resid <span class="sc">&lt;</span>  <span class="fu">quantile</span>({{residname}}, threshold_low, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">|</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      .resid <span class="sc">&gt;</span>  <span class="fu">quantile</span>({{residname}}, threshold_high, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>minEA_threshold <span class="ot">&lt;-</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next we isolate the ‘largest positive or negative outliers’; the countries that are most ‘surprising’ to the model; the 20% of the countries with the most negative residual, and the 20% with the most positive resuduals. Here we also leave out countries with fewer than 10 EAs as well as fewer than 10 predicted EAs.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_linear <span class="ot">&lt;-</span> model_linear <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg <span class="sc">&lt;</span> minEA_threshold <span class="sc">&amp;</span> .fitted <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span>  devplotopts <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Largest residuals, no imputation"</span>) </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/ea_outliers_linear-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Not shown:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_linear_i <span class="ot">&lt;-</span> model_linear_i <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg <span class="sc">&lt;</span> minEA_threshold <span class="sc">&amp;</span> .fitted <span class="sc">&lt;</span>minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> devplotopts <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Largest residuals, Imputed where missing"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</section>
<section id="per-capita-imposing-linearity-in-population" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="per-capita-imposing-linearity-in-population"><span class="header-section-number">2.1.2</span> Per-capita (imposing linearity in population)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ea_dev_percap <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span>  </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap, <span class="at">y=</span>easpercap_per100k, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: predicted, actual, no imputation"</span>) </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_plot-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ea_dev_percap_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>easpercap_per100k, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: predicted, actual, imputed where missings"</span>) </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_plot-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ea_percap_outliers <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  easpercap_per100k <span class="sc">-</span> pred_eapercap) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>(easpercap_per100k<span class="sc">&lt;</span><span class="fl">0.2</span> <span class="sc">&amp;</span> pred_eapercap <span class="sc">&lt;</span><span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>(easpercap_per100k), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: Largest residuals, no imputation"</span>) </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_plot-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ea_percap_outliers_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  easpercap_per100k <span class="sc">-</span> pred_eapercap_i) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>(easpercap_per100k<span class="sc">&lt;</span><span class="fl">0.2</span> <span class="sc">&amp;</span> pred_eapercap <span class="sc">&lt;</span><span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>(easpercap_per100k), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: Largest residuals, Imputed where missing"</span>) </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_eapercap_plot-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the outlier tables above, we drop countries with both less than 2 per million predicted and less than 2 million actual EAs.</p>
<p>Note that the above results are <em>per capita</em>; countries like Norway and Iceland have both many predicted and many EAs per capita, even though they have a small population and few total EAs.</p>
</section>
<section id="log-log-adding-0.1" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="log-log-adding-0.1"><span class="header-section-number">2.1.3</span> Log-log (adding 0.1)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ea_dev_log <span class="ot">&lt;-</span> model_log_linear_p1 <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span> log_eas_3yr_01, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Predicted, actual, no imputation"</span>) </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_log_plot-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ea_dev_log_i <span class="ot">&lt;-</span> model_log_linear_p1_i <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>log_eas_3yr_01, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_log_plot-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_log <span class="ot">&lt;-</span> model_log_linear_p1 <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> <span class="fu">exp</span>(.fitted) <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span><span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>(log_eas_3yr_01), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Largest residuals, no imputation"</span>) </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_log_plot-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_log_i <span class="ot">&lt;-</span> model_log_linear_p1_i <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> <span class="fu">exp</span>(.fitted) <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span><span class="st">`</span><span class="at">log_eas_3yr_01</span><span class="st">`</span>, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Largest residuals, Imputed where missing"</span>) </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_log_plot-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This model appears to be making more reasonable predictions; it is not predicting, e.g., hundreds of EAs in Barbados.</p>
</section>
<section id="exponential-quasi-poisson" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="exponential-quasi-poisson"><span class="header-section-number">2.1.4</span> Exponential (Quasi-Poisson)</h3>
<p>Exponential models are similar in interpretation to log-log models but are often seen as preferable.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ea_dev_qp <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span>  </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP model - EAs: predicted, actual, no imputation"</span>) </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_qp_plot-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ea_dev_qp_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP - EAs: Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_qp_plot-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_qp <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> pred_psn <span class="sc">&lt;</span>minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP = EAs: Largest residuals, no imputation"</span>) </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_qp_plot-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ea_outliers_qp_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn_i) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> pred_psn <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn_i, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP - EAs: Top 5% largest residuals, Imputed where missing"</span>) </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="eas_by_country_files/figure-html/model_ea_qp_plot-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that in the chart above, the ‘top and bottom 20% of outliers’ includes some fairly small outliers. For example, there are some large countries with small residuals listed below that are nonetheess among those with the largest residuals.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m_i <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn_i)  <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(.resid)<span class="sc">&lt;</span><span class="dv">12</span> <span class="sc">&amp;</span> population_3yr_avg<span class="sc">&gt;</span><span class="dv">60</span><span class="sc">*</span><span class="dv">1000</span><span class="sc">*</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>population_3yr_avg) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, population_3yr_avg, eas_3yr_avg, pred_psn_i, .resid )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p></p><table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:usoutlier">
<colgroup><col><col><col><col><col></colgroup><tbody><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">country</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">population_3yr_avg</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">eas_3yr_avg</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">pred_psn_i</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">.resid</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">china</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.41e+09</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12.3&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">22.1&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-9.73</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">india</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.37e+09</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.33&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">15&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-5.7&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">united states</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.29e+08</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">685&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">674&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">11.6&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">brazil</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.11e+08</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">13.3&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.71</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.62</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">russian federation</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.44e+08</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7.33&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.64</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.69</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">mexico</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.28e+08</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.33&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.42</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-2.08</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">turkey</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">8.34e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.667</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.05</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.38</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">france</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.72e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">33.7&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.4&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.29</td></tr>
</tbody></table>
<p></p>
</div>
</div>
</section>
</section>
<section id="table-of-residuals" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="table-of-residuals"><span class="header-section-number">2.2</span> Table of residuals</h2>
<p>Below, a sortable table of residuals from each of the models, by country. (Along with population, EAs and EAs per million, and predicted EAS-per-capita from thethe per-capita model with imputation.)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  eas_v_predicted <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_linear =</span> eas_3yr_avg <span class="sc">-</span> pred_linear,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_linear_i =</span> eas_3yr_avg <span class="sc">-</span> pred_linear_i,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_per100k =</span> easpercap_per100k <span class="sc">-</span> pred_eapercap,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_per100k_i =</span> easpercap_per100k <span class="sc">-</span> pred_eapercap_i,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_log_exp  =</span> eas_3yr_avg <span class="sc">-</span> <span class="fu">exp</span>(pred_log_ea),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_log_exp_i  =</span> eas_3yr_avg <span class="sc">-</span> <span class="fu">exp</span>(pred_log_ea_i),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_psn =</span> eas_3yr_avg <span class="sc">-</span> pred_psn,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_psn_i =</span> eas_3yr_avg <span class="sc">-</span> pred_psn_i</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(country, population_3yr_avg, eas_3yr_avg, easpercap_permil, pred_eapercap_i, <span class="fu">starts_with</span>(<span class="st">"resid_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">class =</span> <span class="st">'cell-border stripe'</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-95ca77e25264a87eb93d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-95ca77e25264a87eb93d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101"],["angola","argentina","australia","austria","barbados","belarus","belgium","bermuda","brazil","bulgaria","burkina faso","cameroon","canada","central african republic","chile","china","colombia","costa rica","croatia","cuba","cyprus","czech republic","democratic republic of the congo","denmark","ecuador","egypt","el salvador","estonia","ethiopia","faroe islands","finland","france","georgia","germany","ghana","greece","guatemala","haiti","hong kong sar china","hungary","iceland","india","ireland","israel","italy","japan","kazakhstan","kenya","latvia","lebanon","lesotho","liberia","lithuania","luxembourg","malaysia","malta","mexico","morocco","myanmar","namibia","netherlands","new zealand","nigeria","norway","oman","pakistan","palestinian territories","papua new guinea","peru","philippines","poland","portugal","qatar","romania","russian federation","rwanda","saudi arabia","senegal","serbia","sierra leone","singapore","slovakia","slovenia","south africa","south korea","spain","sweden","switzerland","taiwan","north macedonia","trinidad and tobago","tunisia","turkey","uganda","united kingdom","united arab emirates","tanzania","uruguay","united states","vietnam","zambia"],[31833784.67,44936659,25347233.33,8879101.67,287010.67,9412831.67,11486758.33,63911.67,211026082.67,6978271,20325375.67,25879504,37567839.33,4747106,18932470,1407144787.33,50294461,5047039.33,4066925.33,11332748.67,1198399,10666552,86806688,5813154,17367025.33,100382027,6453497,1326103.67,112088906.67,48679.67,5522224.67,67243588,3723142,83053205,30419303.67,10718340,16603103,11262931.67,7480066.67,9765618,359915.67,1366354808,4929110,9050633.33,59866789.33,126210017.33,18514855,52579279,1913815,6846853,2125282,4938009,2796855,619456.67,31947940,501341.33,127566354.67,36470471,54054511.33,2494580,17339332.67,4988066.67,200992625,5346429,4970363.33,216561978.67,4685887.33,8776490,32490524.33,108116367,37946431.67,10289055.33,2831604.33,19367712.67,144329400,12627038.67,34261717.67,16298205.33,6942321.67,7813447,5676017.33,5453248.33,2088232.67,58553159,51728706.33,47098670,10269181,8575390,23772370.33,2075147.33,1394767,11692847.33,83369588,44246539.67,66837321.33,9763964,58017706,3461582.67,328889744,96448883.33,17865568],[0.67,2.33,107.33,10.67,0.33,0.67,11,0,13.33,0.33,0.33,0.33,74.33,0.33,2,12.33,2.67,0,1,0,0.33,24,0.33,13,0.33,0.67,0.33,6.33,1,0,9.33,33.67,0,135,0.33,2.33,0,0.33,0,2.67,1.33,9.33,10,11.67,7.33,4,0.67,1,3,0.33,0.67,0.33,0.67,1,1,0,1.33,0.33,0.33,0,40,42,0.67,38.67,0.33,0.67,0,0.33,0,4.33,11.67,4.33,0.33,0.67,7.33,0.67,0.67,0.33,0.33,0.33,10,2,0.33,5.33,2,11.67,24.33,41.67,0,0.67,0.33,0.67,0.67,1.67,265.67,2.33,0.33,0,685.33,0.67,0.67],[0.01,0.07,3.88,1.24,0,0.04,0.96,0,0.05,0,0.02,0,1.8,0.14,0.16,0.01,0.08,0,0.16,0,0.55,2.62,0,2.13,0.02,0.01,0.1,5.53,0.01,0,1.75,0.68,0,1.55,0.02,0.12,0,0.06,0,0.38,5.7,0.01,2.38,1.43,0.12,0.04,0.05,0.03,0.86,0,0.32,0,0.24,2.17,0.03,0,0.01,0,0,0,2.67,9.32,0,8.52,0.07,0,0,0.04,0,0.06,0.26,0.42,0,0.02,0.05,0.05,0.02,0,0,0,1.92,0.37,0.32,0.12,0.03,0.22,1.93,5.01,0,0,0.48,0.06,0,0.05,3.75,0.27,0.01,0,2.02,0.01,0],[0.01,0.03,0.32,0.25,0.08,-0.05,0.14,0.13,0.06,-0.02,-0.02,0.01,0.3,0.01,0,-0.03,0.03,-0.01,0.09,0.01,0.06,0.1,0.01,0.35,0,-0.09,0,0.12,0.01,0.01,0.26,0.21,-0.03,0.28,-0.07,0.11,0.06,-0.02,0.07,0.13,0.33,-0.01,0.33,0.06,0.16,0.16,-0.01,0.02,0.08,-0,0.01,0.01,0.09,0.17,0.04,0.21,-0,-0.01,-0.08,0,0.25,0.33,-0.07,0.34,0.03,-0.1,0.01,0.01,-0.01,0,0.11,0.13,0.02,0.06,-0.01,-0.08,0,0.01,0.01,0.01,0.12,0.07,0.22,0.03,0.01,0.2,0.33,0.25,0.05,0.01,0.08,-0.05,0.02,-0.05,0.32,0.04,0.04,0.1,0.27,-0.01,0],[10.44,18.71,-94.96,-20.52,-148.56,18.69,-12.55,-207.49,12.15,23.25,14.11,10.54,-127.19,14.54,18.58,-59.78,13.39,23.1,-3.85,14.86,-4.82,5.95,9.26,-22.11,13.05,16.54,15.9,-8.72,9.6,15.6,-17.12,2.68,19.01,98.25,17.72,-4.16,10.35,14.14,-30.28,-8.15,-31.8,-59.38,-214.81,-0.35,-17.04,-27.85,-7.92,15.85,-7.43,14.42,15.54,14.69,-11.76,-62.95,-4.33,-190.3,8,11.04,13.8,17.07,9.42,-154.6,11.36,-1.28,-11.31,8.67,15.29,15.3,13.62,17.74,2.38,-5.72,-42.96,-4,-8.54,16.12,-21.96,14.54,21.24,14.57,-37.55,-7.1,-19.9,22.63,-17.84,-14.61,-8.19,-1.8,-18.17,19.42,-145.85,18.35,-10.43,18.03,63.31,-31.23,10.05,13.22,459.29,9,11.28],[-4.85,15.77,-27.71,-19.32,-78.7,21.65,-0.12,-96.03,-4.28,27.73,3,-5.28,-59.68,1.24,17.23,-66.76,1.4,24.49,-1.12,3.53,-2.05,13.53,-4.34,-29.46,1.73,16.64,5.32,-7.46,-4.89,4.32,-20.44,-2.16,15.19,93.69,13.41,-5.73,-5.9,5.37,-8.84,-8.82,-39.13,-72.03,-125.33,8.78,-19.82,-32.53,-5.84,7.74,-5.91,5.75,3.16,1.7,-4.51,-11.25,1.85,-114.66,1.35,-0.13,10.07,8.79,15.52,-93.05,12.39,-2.54,-10.88,9.52,4,3.87,6.94,12.98,5.3,-4.47,-0.91,2.56,0.33,11.93,-9.95,2.58,21.41,1.68,10.67,-3.07,-27.99,20.08,0.33,-23.78,-14.98,6.68,-6.22,14.78,-71.8,15.48,-10.63,12.9,127.42,-6.45,-9.61,-0.71,539.53,1.07,-2.29],[0.01,-0.01,-0.01,-0.11,-0.17,0.05,-0.05,-0.26,-0.04,0.02,0.03,0,-0.21,0.01,0.02,0.03,-0.01,0.02,-0.07,-0,-0.01,0.15,-0,-0.1,0.01,0.09,0.02,0.43,0.01,-0,-0.06,-0.13,0.03,-0.11,0.07,-0.09,-0.05,0.03,-0.1,-0.09,0.27,0.02,-0.19,0.08,-0.14,-0.14,0.01,-0.01,0,0.01,0.03,-0,-0.07,0.02,-0.04,-0.31,0.01,0.01,0.08,0.01,0.02,0.53,0.06,0.54,-0.02,0.09,-0,0,0.02,0.01,-0.08,-0.08,-0.04,-0.06,-0,0.07,-0.01,-0,-0.01,-0,0.05,-0.04,-0.17,-0.02,-0.03,-0.17,-0.11,0.26,-0.06,-0,-0.12,0.06,-0.02,0.05,-0.03,-0.03,-0.02,-0.08,-0.16,0.01,0],[-0.01,-0.02,0.07,-0.13,-0.08,0.06,-0.04,-0.13,-0.06,0.02,0.03,-0.01,-0.12,0,0.01,0.03,-0.02,0.01,-0.07,-0.01,-0.01,0.16,-0.01,-0.13,0,0.09,0.01,0.43,-0,-0.01,-0.08,-0.15,0.03,-0.13,0.07,-0.09,-0.06,0.03,-0.07,-0.09,0.24,0.01,-0.1,0.08,-0.15,-0.15,0.02,-0.02,0,0,0.02,-0.01,-0.06,0.05,-0.03,-0.21,0,0.01,0.08,-0,0.01,0.61,0.07,0.51,-0.02,0.1,-0.01,-0.01,0.01,0,-0.08,-0.09,-0.02,-0.06,0.02,0.08,-0,-0.01,-0.01,-0.01,0.07,-0.04,-0.19,-0.02,-0,-0.18,-0.13,0.25,-0.05,-0.01,-0.03,0.06,-0.02,0.05,0.05,-0.02,-0.04,-0.1,-0.06,0.01,-0],[0.33,-1.24,16.8,-3.05,0.02,0.29,5.24,-0.38,7.71,-0.39,0.23,0.11,-25.29,0.29,0.77,0.06,1.23,-0.51,-0.34,-0.22,0.03,21.27,0.01,-16.84,-0.04,0.04,0.14,5.66,0.5,-0.01,-1.31,10.16,-0.17,54.3,0.14,-0.08,-0.73,0.22,-1.64,-0.7,-2.56,1.45,-32.86,10.2,-4.46,-10.32,0.25,-0.16,2.49,0.07,0.62,0.28,-0.29,-0.44,-1.55,-2.32,-1.38,-0.1,0.14,-0.13,6.25,13.32,-0.66,10.53,0.05,0.04,-0.12,0.16,-0.71,1.67,3.35,0.36,-0.01,-2.1,4.08,0.62,-0.23,0.11,-0.51,0.25,5,0.89,-2.3,0.71,-0.82,-1.83,-13.32,29.91,-2.15,0.42,-1.25,0.46,-1.22,1.47,93.96,1.34,-0.1,-0.87,306.58,-0.5,0.49],[0.03,-1.16,60.18,-0.89,0.02,0.25,6.63,-0.2,6.77,-0.41,0.03,-0.19,23.81,0.15,0.76,1.97,0.86,-0.58,-0.37,-0.47,-0.02,21.7,-0.79,-14.39,-0.24,-0.08,-0.01,5.61,-0.28,-0.02,-0.45,14.62,-0.24,74.16,-0.02,-0.09,-1.24,0.04,-1.2,-0.56,-3.06,-0.52,-10.02,10.39,-2.46,-7.57,0.23,-1.11,2.44,-0.04,0.52,0.12,-0.24,0.05,-1.22,-1.54,-1.44,-0.39,-0.02,-0.23,15.03,23.79,-1.27,14.39,0.02,-0.3,-0.28,-0.07,-0.94,0.87,4.74,0.67,0.09,-1.75,4.84,0.53,-0.05,-0.21,-0.64,0.05,7.17,0.91,-2.56,0.31,0.07,-0.47,-8.63,32.4,-1.68,0.33,-0.79,0.36,-1.08,1.17,178.99,1.61,-0.82,-1.14,544.77,-1,0.25],[0.38,-1.59,-8.96,-6.62,0.05,0.3,2.97,-0.66,7.12,-0.49,0.28,0.19,-41.94,0.32,0.65,-3.62,1.1,-0.64,-0.48,-0.14,-0.05,20.87,0.21,-21.02,-0.04,-0.3,0.16,5.63,0.68,-0,-2.83,1.9,-0.18,24.81,0.15,-0.75,-0.52,0.27,-2.34,-1.09,-2.31,0.79,-54.47,9.38,-10.9,-16.04,0.08,0.28,2.49,0.08,0.65,0.31,-0.43,-1.45,-2.4,-2.51,-1.79,-0.02,0.18,-0.11,-0.47,10.83,-0.53,6.02,-0.1,0.08,-0.07,0.22,-0.7,1.89,0.16,-0.81,-0.83,-3.28,2.74,0.64,-1.39,0.2,-0.47,0.3,-0.8,0.82,-2.35,1.18,-1.75,-3.94,-14.22,25.91,-3.09,0.43,-1.61,0.45,-2.58,1.55,39.72,0.14,0.05,-0.81,1.96,-0.26,0.57],[0.32,-2.06,2.44,-5.09,0.1,0.32,3.82,-0.33,5.62,-0.46,0.24,0.13,-34.69,0.31,0.72,-9.73,0.95,-0.6,-0.42,-0.19,0.02,21.2,0.05,-19.4,-0.06,-0.42,0.14,5.77,0.42,-0,-1.98,2.29,-0.17,17.37,0.1,-0.69,-0.64,0.25,-1.76,-1.03,-1.6,-5.7,-35.81,9.72,-10.16,-15.4,0.18,-0.23,2.57,0.09,0.64,0.3,-0.26,-0.51,-2.46,-1.77,-2.08,-0.1,0.12,-0.12,-1.29,15.55,-1.34,8.71,0.01,-0.25,-0.1,0.18,-0.78,0.68,-0.77,-0.72,-0.3,-3.29,2.69,0.63,-0.81,0.13,-0.52,0.27,1.93,0.93,-1.99,-0.44,-1.38,-3.72,-14.8,28.76,-2.66,0.45,-1.27,0.44,-2.38,1.46,44.18,0.88,-0.14,-0.74,11.6,-0.6,0.53]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>country<\/th>\n      <th>population_3yr_avg<\/th>\n      <th>eas_3yr_avg<\/th>\n      <th>easpercap_permil<\/th>\n      <th>pred_eapercap_i<\/th>\n      <th>resid_linear<\/th>\n      <th>resid_linear_i<\/th>\n      <th>resid_per100k<\/th>\n      <th>resid_per100k_i<\/th>\n      <th>resid_log_exp<\/th>\n      <th>resid_log_exp_i<\/th>\n      <th>resid_psn<\/th>\n      <th>resid_psn_i<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10,11,12,13]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="exporting-all-data-and-model-results-to-git-and-gsheets" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exporting all data (and model results) to git and Gsheets</h1>
<p>As RData, csv in the Github repo</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(eas_by_country_all_m, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_no_imputation.RData"</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(eas_by_country_all_m_i, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_missings_imputed.RData"</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(eas_by_country_all_m, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_no_imputation.csv"</span>))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(eas_by_country_all_m_i, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_missings_imputed.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Exporting the data and predictions to the Gsheet <a href="https://docs.google.com/spreadsheets/d/1OcxxMTjMPT1gg2w47h9ADn_eLDn_QcvCjMKdEBDZKFc/edit#gid=325316997">HERE</a></p>
<p>Unfortunately, it makes a new sheet each time; need to find a fix for this! Thus the code below is set to not be run automatically.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Need authorisation to write to RP drive</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scopes =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>,  <span class="at">email =</span> <span class="st">"dreinstein@rethinkpriorities.org"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>(eas_gsheet <span class="ot">&lt;-</span> <span class="fu">gs4_create</span>(<span class="st">"EAs_by_country_rich_data_predictions"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheets =</span> <span class="fu">list</span>(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">with_imputation =</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>      eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.infinite</span>(.), <span class="dv">1</span>)), </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_imputation =</span> eas_by_country_all_m <span class="sc">%&gt;%</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.infinite</span>(.), <span class="dv">1</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>For other countries where it is missing, we either drop this country (‘no imputation models’) or impute it at the average for the country’s “Cultural Zone”.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>More careful work could do linear or nearest-neighbor imputation, or a specific model of missingness. We should also check the sensitivity of our results to these imputations.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>With the tidy modeling tools we would do this more carefully, creating ‘recipes’ etc. I keep it a bit simpler for now. If we end up running more models and comparisons we may want to automate this more.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Note that for ‘constant elasticity models’ (log-log and exponential, i.e.&nbsp;Quasi-poisson) I log the features that are in real units; gdp-per capita and population to allow either linear or constant elasticity relationships. I do not log the features that are percentage indices, such as the English composite measure or the WVS indices.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5" role="doc-endnote"><p><code>gdppop_3yr_avg</code> the slope in GDP per capita, for countries with below-median GDP per capita. <code>gdppop_3yr_avg_above_med</code> the adjustment to this slope for countries with above-median GDP per capita <code>gdppop_3yr_avg +gdppop_3yr_avg_above_med</code> would thus be the slope in GDP for countries with above-median GDP per capita.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6" role="doc-endnote"><p>Given the above strange result, we will not report this for the imputed model for this case; this tends to leave out smaller countries, a good thing in this case.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7" role="doc-endnote"><p>In the final graph above it looks like there are more negative than positive residuals. However, note these are presented on a log scale, and thus the observations above the line are ‘more overperforming’ than those just below the line.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">project:</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">  type: website</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">  output-dir: docs/vignettes</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 3</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">    citations-hover: true</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">    footnotes-hover: true</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">    margin-right: .1em</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">    freeze: auto # re-render only when source changes</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">    message: false</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">    error: true</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="an">comments:</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">    hypothesis: true</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># EAS by country: understanding drivers, the search for outliers and untapped 'markets' </span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>here <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>()</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>filter</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnoodling)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinkpriorities)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(broom,  dplyr, ggplot2,  ggrepel, janitor, kableExtra, readr, tidyr, tidyselect, tidymodels, tidyverse, plotly, DT,  <span class="at">install =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(huxtable)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(modelr)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(httr)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(viridis, ggsci)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(googlesheets4)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bring in country level data (input by hand, etc)</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r input_eapercap}</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"EAs per capita across time - Compiled Dataset.csv"</span>), <span class="at">skip=</span><span class="dv">1</span>, <span class="at">na=</span><span class="fu">c</span>(<span class="st">"N/A"</span>))</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Alt: input direct from Google sheets </span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="co">#May need authorisation to writeread from RP drive</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scopes =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>,  <span class="at">email =</span> <span class="st">"dreinstein@rethinkpriorities.org"</span>)</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span><span class="fu">read_sheet</span>(</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">ss =</span> <span class="st">"https://docs.google.com/spreadsheets/d/1-oTtv71FnMfenXJtHiPwnhh-Za10s46AGmDLp4mnjvY/edit#gid=1909032845"</span>, <span class="at">sheet =</span> <span class="st">"Compiled Dataset"</span>, <span class="at">skip=</span><span class="dv">1</span>,  <span class="at">na=</span><span class="fu">c</span>(<span class="st">"N/A"</span>)) </span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(across(matches("GDP|"), as.numeric)) %&gt;% </span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(EAspercapita_2018, EAspercapita_2019, EAspercapita_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap_per100k =</span> easpercap<span class="sc">*</span><span class="dv">100</span><span class="sc">*</span><span class="dv">1000</span>,</span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_easpercap =</span> <span class="fu">log</span>(easpercap),</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">eas_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(EAs_2018, EAs_2019, EAs_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_eas_3yr_01 =</span> <span class="fu">log</span>(eas_3yr_avg <span class="sc">+</span> <span class="fl">0.1</span>),</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">population_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(Population_2018, Population_2019, Population_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdpppp_3yr_avg =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">c</span>(GDPPPP_2018, GDPPPP_2019, GDPPPP_2020), <span class="at">na.rm=</span><span class="cn">TRUE</span>)),</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdppop_3yr_avg =</span>  gdpppp_3yr_avg<span class="sc">/</span>population_3yr_avg,</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_gdppop_3yr_avg =</span> (<span class="fu">log</span>(gdppop_3yr_avg)),</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>med_country_gdppop <span class="ot">&lt;-</span> <span class="fu">median</span>(eas_by_country_all<span class="sc">$</span>gdppop_3yr_avg, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdppop_3yr_avg_above_med =</span> gdppop_3yr_avg<span class="sc">*</span>(gdppop_3yr_avg<span class="sc">&gt;</span>med_country_gdppop),</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_gdppop_3yr_avg_above_med =</span> log_gdppop_3yr_avg<span class="sc">*</span>(gdppop_3yr_avg<span class="sc">&gt;</span>med_country_gdppop),</span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further English language features and imputation</span></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>We add the UK Government classification of 'majority native English speaking' according to <span class="co">[</span><span class="ot">university websites</span><span class="co">](https://www.northampton.ac.uk/international/english-language-requirements/majority-native-english-speaking-countries/)</span>.</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>uk_govt_classified_english_speaking <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"uk_govt_classified_english_speaking.csv"</span>),</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">country=</span><span class="fu">tolower</span>(X1)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_uk_english =</span><span class="dv">1</span>)</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(uk_govt_classified_english_speaking, <span class="at">by=</span><span class="st">"country"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_uk_english =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>    country<span class="sc">==</span><span class="st">"united states"</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co">#USA named differently in other data, needed fixing</span></span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a>    country<span class="sc">==</span><span class="st">"bermuda"</span> <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co">#an obvious omission</span></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(d_uk_english) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">FALSE</span></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a>We input a measure of English proficiency by country, from <span class="ot">&lt;https://en.wikipedia.org/wiki/EF_English_Proficiency_Index&gt;</span>, through a <span class="co">[</span><span class="ot">Kaggler</span><span class="co">](https://www.kaggle.com/datasets/mathurinache/ef-english-proficiency-index?resource=download)</span>.</span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r epi_input}</span></span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a>EF_English_Proficiency_Index <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"EF_English_Proficiency_Index.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"ef_epi_19"</span><span class="ot">=</span> <span class="st">`</span><span class="at">2019 Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country=</span><span class="fu">tolower</span>(Country),</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">country =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"mainland china"</span> <span class="sc">~</span> <span class="st">"china"</span>,</span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"russia"</span> <span class="sc">~</span> <span class="st">"russian federation"</span>,</span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a>        country <span class="sc">==</span> <span class="st">"hong kong"</span> <span class="sc">~</span> <span class="st">"hong kong sar china"</span>,</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> country</span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(country, ef_epi_19)</span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a>Our analysis (not shown) arguably suggested that the proficiency measure was the more reasonable one. However, this measure is missing for predominantly-English-speaking countries; we semi-arbitrarily assign these countries a score of 80.^<span class="co">[</span><span class="ot">For other countries where it is missing, we either drop this country ('no imputation models') or impute it at the average for the country's "Cultural Zone".</span><span class="co">]</span></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r epi_join_adjust}</span></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(EF_English_Proficiency_Index, <span class="at">by =</span> <span class="st">"country"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ef_epi_19_adj =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a>    d_uk_english <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">80</span>,</span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> ef_epi_19)</span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## Another 'average' measure, not used in modeling below</span></span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a>The two English prevalence/proficiency measures cover different countries, each with many missing values. As a compromise measure, we averaged these two, taking the nonmissing value of one where the other is missing, a feature we call <span class="in">`english_av`</span>. Where both are missing for a country, we took the average of the above average for the "Cultural Zone" of the country. (Code chunk below).</span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r english_av}</span></span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">english_speakers_pctl =</span> <span class="fu">rank</span>(EnglishSpeakers, <span class="at">ties.method =</span> <span class="fu">c</span>(<span class="st">"average"</span>), <span class="at">na.last=</span><span class="st">"keep"</span>)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(EnglishSpeakers)),</span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">ef_epi_19_pctl =</span> <span class="fu">rank</span>(ef_epi_19, <span class="at">ties.method =</span> <span class="fu">c</span>(<span class="st">"average"</span>), <span class="at">na.last=</span><span class="st">"keep"</span>)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(ef_epi_19)),</span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a>eas_by_country_all<span class="sc">$</span>english_av <span class="ot">&lt;-</span> </span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowMeans</span>(eas_by_country_all <span class="sc">%&gt;%</span> <span class="fu">select</span>(ef_epi_19_pctl, english_speakers_pctl) <span class="sc">%&gt;%</span> as.matrix, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> <span class="co">#impute to regional average where missing</span></span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CulturalZone) <span class="sc">%&gt;%</span></span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">english_av_zone =</span> <span class="fu">mean</span>(english_av, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">english_av =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(english_av) <span class="sc">~</span> english_av_zone,</span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> english_av)</span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a><span class="co"># next take the average of the nonmissing percentiles</span></span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a>What does the "English proficiency" feature look like?:</span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r english_shown}</span></span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a>eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, ef_epi_19_adj) <span class="sc">%&gt;%</span></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>(<span class="at">class =</span> <span class="st">'cell-border stripe'</span>)</span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a>english_plot <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>EnglishSpeakers, <span class="at">y=</span>ef_epi_19_adj, <span class="at">color=</span>d_uk_english) <span class="sc">+</span></span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> country),</span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding   =</span> <span class="fl">0.3</span>, </span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a>                  <span class="at">point.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="st">'grey50'</span>) <span class="sc">+</span></span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"English proficiency measure versus 'English Speakers share'"</span>) </span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other imputation </span></span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a>We quickly impute all other features (where they are missing) by taking the average for the "Cultural Zone" (relevant for below models: <span class="in">`Emancipative`</span> and <span class="in">`Secular`</span>). The data frame with imputed values is called <span class="in">`eas_by_country_all_i`</span>, the one without imputations is <span class="in">`eas_by_country_all`</span>.^<span class="co">[</span><span class="ot">More careful work could do linear or nearest-neighbor imputation, or a specific model of missingness. We should also check the sensitivity of our results to these imputations.</span><span class="co">]</span></span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add_labels}</span></span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a><span class="co">#eas_by_country_all_i &lt;- eas_by_country_all %&gt;% </span></span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a><span class="co">#labelled::set_variable_labels(.labels = as.list(all_char_labels), .strict=FALSE)</span></span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r imputation}</span></span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a><span class="co">#imputation where missing</span></span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_i <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CulturalZone) <span class="sc">%&gt;%</span></span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="fu">median</span>(x, <span class="at">na.rm =</span> T), x)) <span class="sc">%&gt;%</span></span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a><span class="fu"># Models</span></span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a>I typically like to define the 'key features' and 'key outcomes' up top. I started on this here, but didn't do it too much.^<span class="co">[</span><span class="ot">With the tidy modeling tools we would do this more carefully, creating 'recipes' etc. I keep it a bit simpler for now. If we end up running more models and comparisons we may want to automate this more.</span><span class="co">]</span></span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r modelprep}</span></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a><span class="co">#key features</span></span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a>features_percap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gdppop_3yr_avg"</span>, <span class="st">"gdppop_3yr_avg_above_med"</span>, <span class="st">"d_uk_english"</span>, <span class="st">"ef_epi_19_adj"</span>, <span class="st">"Emancipative"</span>, <span class="st">"Secular"</span>)</span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"population_3yr_avg"</span>, features_percap)</span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-242"><a href="#cb37-242" aria-hidden="true" tabindex="-1"></a>log_features_percap <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"log_gdppop_3yr_avg"</span>, <span class="st">"d_uk_english"</span>, <span class="st">"ef_epi_19_adj"</span>,  <span class="st">"Emancipative"</span>, <span class="st">"Secular"</span>)</span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a>log_features <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"log(population_3yr_avg)"</span>, log_features_percap)</span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a><span class="co">#This makes complete cases only:</span></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a><span class="co">#eas_by_country_all_nomissing &lt;- eas_by_country_all %&gt;%  na.omit(features)</span></span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(eas_by_country_all) <span class="ot">&lt;-</span> eas_by_country_all<span class="sc">$</span>country  </span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(eas_by_country_all_i) <span class="ot">&lt;-</span> eas_by_country_all_i<span class="sc">$</span>country  </span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a><span class="co">#Using rownames is an annoying workaround to get labels in graphs later. There's probably a better way.</span></span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a>Below, we construct models </span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>imputed and complete-case-only data, </span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>with linear, log transformations (adding a small number to avoid dropping 0's), and exponential (quasi-Poisson) specifications^<span class="co">[</span><span class="ot">Note that for 'constant elasticity models' (log-log and exponential, i.e. Quasi-poisson) I log the features that are in real units; gdp-per capita and population to allow either linear or constant elasticity relationships. I do not log the features that are percentage indices, such as the English composite measure or the WVS indices.</span><span class="co">]</span></span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>with level and per-capita outcomes (the latter imposes linearity in population).</span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lm_ea_all}</span></span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a>model_linear <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, features), .) </span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a>model_linear_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, features), .) </span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a><span class="co">#model_log_eapercap &lt;- eas_by_country_all %&gt;%  filter(easpercap&gt;0) %&gt;% lm(make_formula("log_easpercap", log_features_percap), .)  model_log_eapercap_i &lt;- eas_by_country_all_i %&gt;%  filter(easpercap&gt;0) %&gt;% lm(make_formula("log_easpercap", log_features_percap), </span></span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-272"><a href="#cb37-272" aria-hidden="true" tabindex="-1"></a>model_eapercap <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb37-273"><a href="#cb37-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"easpercap_per100k"</span>, features_percap), .)</span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a>model_eapercap_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"easpercap_per100k"</span>, features_percap), .)</span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a>model_log_linear_p1 <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span> </span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"log_eas_3yr_01"</span>, log_features), .) </span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a>model_log_linear_p1_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span> <span class="fu">lm</span>(<span class="fu">make_formula</span>(<span class="st">"log_eas_3yr_01"</span>, log_features), .) </span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a>model_ea_psn <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span>  <span class="fu">glm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, log_features), <span class="at">family=</span>quasipoisson, <span class="at">data =</span>.) </span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a>model_ea_psn_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span>  <span class="fu">glm</span>(<span class="fu">make_formula</span>(<span class="st">"eas_3yr_avg"</span>, log_features), <span class="at">family=</span>quasipoisson, <span class="at">data =</span>.) </span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a>We put the coefficients of these models into summary tables below:</span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ea_by_country_all_models_table}</span></span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a>ea_by_country_all_models_table <span class="ot">&lt;-</span> </span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a><span class="fu">huxreg</span>(</span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Linear"</span> <span class="ot">=</span> model_linear, </span>
<span id="cb37-294"><a href="#cb37-294" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_linear_i,</span>
<span id="cb37-295"><a href="#cb37-295" aria-hidden="true" tabindex="-1"></a>   <span class="st">"Per `100k` capita"</span> <span class="ot">=</span> model_eapercap, </span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_eapercap_i, </span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a>  <span class="st">"log EAs + 0.1"</span> <span class="ot">=</span> model_log_linear_p1, </span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span>  model_log_linear_p1_i,</span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Quasi-Poisson"</span> <span class="ot">=</span> model_ea_psn,</span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a>  <span class="st">"... imputed"</span> <span class="ot">=</span> model_ea_psn_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_number_format</span>(<span class="at">row=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">col=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">value=</span><span class="st">"%#.2f"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a>   <span class="fu">set_bold</span>(<span class="dv">1</span>, everywhere) <span class="sc">%&gt;%</span></span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_bottom_border</span>(<span class="dv">1</span>, everywhere) <span class="sc">%&gt;%</span></span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_caption_pos</span>(<span class="st">"top"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_caption</span>(<span class="st">"EAs by country: Models"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_col_width</span>(<span class="fu">c</span>(.<span class="dv">25</span>, <span class="fu">rep</span>(.<span class="dv">13</span>,<span class="dv">8</span>)))</span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-309"><a href="#cb37-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-310"><a href="#cb37-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a>^[<span class="in">`gdppop_3yr_avg`</span> the slope in GDP per capita, for countries with below-median GDP per capita.</span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a><span class="in">`gdppop_3yr_avg_above_med`</span> the adjustment to this slope for countries with above-median GDP per capita</span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a><span class="in">`gdppop_3yr_avg +gdppop_3yr_avg_above_med`</span>  would thus be the slope in GDP for countries with above-median GDP per capita.]</span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a>Next, we add the predicted values to the basic data set (imputed and non), to later make tables of  predictions, and residuals, and share that data </span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eas_by_country_all_m}</span></span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a><span class="co">#the repetition for both data sets below is rubbish -- I should use 'map' instead</span></span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-321"><a href="#cb37-321" aria-hidden="true" tabindex="-1"></a>add_preds <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb37-322"><a href="#cb37-322" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_predictions</span>(model_linear, <span class="at">var =</span> <span class="st">"pred_linear"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_linear_i, <span class="at">var =</span> <span class="st">"pred_linear_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_eapercap, <span class="at">var =</span> <span class="st">"pred_eapercap"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_eapercap_i, <span class="at">var =</span> <span class="st">"pred_eapercap_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_log_linear_p1, <span class="at">var =</span> <span class="st">"pred_log_ea"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_log_linear_p1_i, <span class="at">var =</span> <span class="st">"pred_log_ea_i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_ea_psn, <span class="at">var =</span> <span class="st">"pred_psn"</span>, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(model_ea_psn_i, <span class="at">var =</span> <span class="st">"pred_psn_i"</span>, <span class="at">type=</span><span class="st">"response"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">exp_pred_log_ea =</span> <span class="fu">exp</span>(pred_log_ea),</span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a>        <span class="at">exp_pred_log_ea_i =</span> <span class="fu">exp</span>(pred_log_ea_i),</span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_eapercap_permil =</span> pred_eapercap<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_eapercap_permil_i =</span> pred_eapercap_i<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a>    <span class="at">easpercap_permil =</span> easpercap<span class="sc">*</span><span class="dv">1000</span><span class="sc">*</span><span class="dv">1000</span>)</span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-339"><a href="#cb37-339" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m_i <span class="ot">&lt;-</span> eas_by_country_all_i <span class="sc">%&gt;%</span></span>
<span id="cb37-340"><a href="#cb37-340" aria-hidden="true" tabindex="-1"></a>add_preds </span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m <span class="ot">&lt;-</span> eas_by_country_all <span class="sc">%&gt;%</span></span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a>  add_preds</span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting predicted versus actual levels and largest 'outliers'</span></span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r devplotopts}</span></span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-353"><a href="#cb37-353" aria-hidden="true" tabindex="-1"></a>devplotopts <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>), </span>
<span id="cb37-354"><a href="#cb37-354" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> country),</span>
<span id="cb37-355"><a href="#cb37-355" aria-hidden="true" tabindex="-1"></a>                  <span class="at">box.padding   =</span> <span class="fl">0.3</span>, </span>
<span id="cb37-356"><a href="#cb37-356" aria-hidden="true" tabindex="-1"></a>                  <span class="at">point.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> <span class="st">'grey50'</span>),</span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span><span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">'grey'</span>),</span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>(), </span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis</span>(<span class="at">option =</span> <span class="st">"H"</span>)</span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a>We plot the predicted and actual numbers (or population shares) of EAs for each country, for most of the models. For each, we first plot the 'complete cases' only, and then the models with imputed missing values of features.</span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a>In each case countries above the grey degree line represent 'overperformers'  relative to prediction and those below it 'underperformers'.  Note that while these are linear models, we plot on a log scale to make it more visible. This (falsely) suggest that the prediction is not centered, as moving above the line increases more quickly than moving below it decreases.</span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a>We color the country dots based on their English prevalence and proficiency score. </span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear</span></span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_eapercap_linear}</span></span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-378"><a href="#cb37-378" aria-hidden="true" tabindex="-1"></a>ea_dev_linear <span class="ot">&lt;-</span> model_linear <span class="sc">%&gt;%</span> </span>
<span id="cb37-379"><a href="#cb37-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span></span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear model, log scales): Predicted, actual, no imputation"</span>) </span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a>ea_dev_linear_i <span class="ot">&lt;-</span> model_linear_i <span class="sc">%&gt;%</span> </span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a>        devplotopts <span class="sc">+</span></span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> </span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>) <span class="sc">+</span> </span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb37-395"><a href="#cb37-395" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-396"><a href="#cb37-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a>Note that the linear model is making some strange predictions, e.g., predicting very high numbers of EAs for small English-speaking/fluent countries. This is may be because the lack of proportionality doesn't allow population to 'matter enough.' We will report on this model a bit less below.</span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-405"><a href="#cb37-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-406"><a href="#cb37-406" aria-hidden="true" tabindex="-1"></a>resid_threshold <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a>threshold_low <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a>threshold_high <span class="ot">&lt;-</span>  <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a>resid_filter <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">threshold_low =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">threshold_high =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">residname =</span> .resid) {</span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.resid <span class="sc">&lt;</span>  <span class="fu">quantile</span>({{residname}}, threshold_low, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">|</span></span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a>      .resid <span class="sc">&gt;</span>  <span class="fu">quantile</span>({{residname}}, threshold_high, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a>minEA_threshold <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a>Next we isolate the 'largest positive or negative outliers'; the countries that are most 'surprising' to the model; the <span class="in">`r threshold_low*100`</span>% of the countries with the most negative residual, and the <span class="in">`r 100-threshold_high*100`</span>% with the most positive resuduals. Here we also leave out countries with fewer than <span class="in">`r minEA_threshold`</span> EAs as well as  fewer than <span class="in">`r minEA_threshold`</span> predicted EAs.^<span class="co">[</span><span class="ot">Given the above strange result, we will not report this for the imputed model for this case; this tends to leave out smaller countries, a good thing in this case.</span><span class="co">]</span></span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ea_outliers_linear}</span></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a>ea_outliers_linear <span class="ot">&lt;-</span> model_linear <span class="sc">%&gt;%</span></span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb37-428"><a href="#cb37-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb37-429"><a href="#cb37-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg <span class="sc">&lt;</span> minEA_threshold <span class="sc">&amp;</span> .fitted <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span>  devplotopts <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-433"><a href="#cb37-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Largest residuals, no imputation"</span>) </span>
<span id="cb37-434"><a href="#cb37-434" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-435"><a href="#cb37-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-436"><a href="#cb37-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-437"><a href="#cb37-437" aria-hidden="true" tabindex="-1"></a><span class="co">#Not shown:</span></span>
<span id="cb37-438"><a href="#cb37-438" aria-hidden="true" tabindex="-1"></a>ea_outliers_linear_i <span class="ot">&lt;-</span> model_linear_i <span class="sc">%&gt;%</span></span>
<span id="cb37-439"><a href="#cb37-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-440"><a href="#cb37-440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> </span>
<span id="cb37-441"><a href="#cb37-441" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg <span class="sc">&lt;</span> minEA_threshold <span class="sc">&amp;</span> .fitted <span class="sc">&lt;</span>minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-442"><a href="#cb37-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> devplotopts <span class="sc">+</span></span>
<span id="cb37-443"><a href="#cb37-443" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-444"><a href="#cb37-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-445"><a href="#cb37-445" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAS per capita (linear, log scales): Largest residuals, Imputed where missing"</span>) </span>
<span id="cb37-446"><a href="#cb37-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-447"><a href="#cb37-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-448"><a href="#cb37-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-449"><a href="#cb37-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-450"><a href="#cb37-450" aria-hidden="true" tabindex="-1"></a>^<span class="co">[</span><span class="ot">In the final graph above it looks like there are more negative than positive residuals. However, note these are presented on a log scale, and thus the observations above the line are 'more overperforming' than those just below the line.</span><span class="co">]</span></span>
<span id="cb37-451"><a href="#cb37-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-452"><a href="#cb37-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-453"><a href="#cb37-453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Per-capita (imposing linearity in population)</span></span>
<span id="cb37-454"><a href="#cb37-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-455"><a href="#cb37-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-456"><a href="#cb37-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_eapercap_plot}</span></span>
<span id="cb37-457"><a href="#cb37-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-458"><a href="#cb37-458" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-459"><a href="#cb37-459" aria-hidden="true" tabindex="-1"></a>ea_dev_percap <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span>  </span>
<span id="cb37-460"><a href="#cb37-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-461"><a href="#cb37-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap, <span class="at">y=</span>easpercap_per100k, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-462"><a href="#cb37-462" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-463"><a href="#cb37-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: predicted, actual, no imputation"</span>) </span>
<span id="cb37-464"><a href="#cb37-464" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-465"><a href="#cb37-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-466"><a href="#cb37-466" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-467"><a href="#cb37-467" aria-hidden="true" tabindex="-1"></a>ea_dev_percap_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb37-468"><a href="#cb37-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-469"><a href="#cb37-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>easpercap_per100k, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-470"><a href="#cb37-470" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-471"><a href="#cb37-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: predicted, actual, imputed where missings"</span>) </span>
<span id="cb37-472"><a href="#cb37-472" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-473"><a href="#cb37-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-474"><a href="#cb37-474" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-475"><a href="#cb37-475" aria-hidden="true" tabindex="-1"></a>ea_percap_outliers <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span></span>
<span id="cb37-476"><a href="#cb37-476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  easpercap_per100k <span class="sc">-</span> pred_eapercap) <span class="sc">%&gt;%</span> </span>
<span id="cb37-477"><a href="#cb37-477" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb37-478"><a href="#cb37-478" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>(easpercap_per100k<span class="sc">&lt;</span><span class="fl">0.2</span> <span class="sc">&amp;</span> pred_eapercap <span class="sc">&lt;</span><span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-479"><a href="#cb37-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-480"><a href="#cb37-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>(easpercap_per100k), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-481"><a href="#cb37-481" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-482"><a href="#cb37-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: Largest residuals, no imputation"</span>) </span>
<span id="cb37-483"><a href="#cb37-483" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-484"><a href="#cb37-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-485"><a href="#cb37-485" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-486"><a href="#cb37-486" aria-hidden="true" tabindex="-1"></a>ea_percap_outliers_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span></span>
<span id="cb37-487"><a href="#cb37-487" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  easpercap_per100k <span class="sc">-</span> pred_eapercap_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-488"><a href="#cb37-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb37-489"><a href="#cb37-489" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span>(easpercap_per100k<span class="sc">&lt;</span><span class="fl">0.2</span> <span class="sc">&amp;</span> pred_eapercap <span class="sc">&lt;</span><span class="fl">0.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-490"><a href="#cb37-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-491"><a href="#cb37-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_eapercap_i, <span class="at">y=</span>(easpercap_per100k), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-492"><a href="#cb37-492" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-493"><a href="#cb37-493" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"EAs per 100k capita: Largest residuals, Imputed where missing"</span>) </span>
<span id="cb37-494"><a href="#cb37-494" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-495"><a href="#cb37-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-496"><a href="#cb37-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-497"><a href="#cb37-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-498"><a href="#cb37-498" aria-hidden="true" tabindex="-1"></a>For the outlier tables above, we drop countries with both less than 2 per million predicted and less than 2 million actual EAs.</span>
<span id="cb37-499"><a href="#cb37-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-500"><a href="#cb37-500" aria-hidden="true" tabindex="-1"></a>Note that the above results are *per capita*; countries like Norway and  Iceland have both many predicted and many EAs per capita, even though they have a small population and few total EAs.</span>
<span id="cb37-501"><a href="#cb37-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-502"><a href="#cb37-502" aria-hidden="true" tabindex="-1"></a><span class="fu">### Log-log (adding 0.1)</span></span>
<span id="cb37-503"><a href="#cb37-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-504"><a href="#cb37-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_ea_log_plot}</span></span>
<span id="cb37-505"><a href="#cb37-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-506"><a href="#cb37-506" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-507"><a href="#cb37-507" aria-hidden="true" tabindex="-1"></a>ea_dev_log <span class="ot">&lt;-</span> model_log_linear_p1 <span class="sc">%&gt;%</span> </span>
<span id="cb37-508"><a href="#cb37-508" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb37-509"><a href="#cb37-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-510"><a href="#cb37-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span> log_eas_3yr_01, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-511"><a href="#cb37-511" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-512"><a href="#cb37-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Predicted, actual, no imputation"</span>) </span>
<span id="cb37-513"><a href="#cb37-513" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-514"><a href="#cb37-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-515"><a href="#cb37-515" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-516"><a href="#cb37-516" aria-hidden="true" tabindex="-1"></a>ea_dev_log_i <span class="ot">&lt;-</span> model_log_linear_p1_i <span class="sc">%&gt;%</span> </span>
<span id="cb37-517"><a href="#cb37-517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-518"><a href="#cb37-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-519"><a href="#cb37-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>log_eas_3yr_01, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span> </span>
<span id="cb37-520"><a href="#cb37-520" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-521"><a href="#cb37-521" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb37-522"><a href="#cb37-522" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-523"><a href="#cb37-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-524"><a href="#cb37-524" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-525"><a href="#cb37-525" aria-hidden="true" tabindex="-1"></a>ea_outliers_log <span class="ot">&lt;-</span> model_log_linear_p1 <span class="sc">%&gt;%</span></span>
<span id="cb37-526"><a href="#cb37-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all) <span class="sc">%&gt;%</span> </span>
<span id="cb37-527"><a href="#cb37-527" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb37-528"><a href="#cb37-528" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> <span class="fu">exp</span>(.fitted) <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-529"><a href="#cb37-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span><span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>(log_eas_3yr_01), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-530"><a href="#cb37-530" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-531"><a href="#cb37-531" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Largest residuals, no imputation"</span>) </span>
<span id="cb37-532"><a href="#cb37-532" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-533"><a href="#cb37-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-534"><a href="#cb37-534" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-535"><a href="#cb37-535" aria-hidden="true" tabindex="-1"></a>ea_outliers_log_i <span class="ot">&lt;-</span> model_log_linear_p1_i <span class="sc">%&gt;%</span></span>
<span id="cb37-536"><a href="#cb37-536" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">newdata=</span>eas_by_country_all_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-537"><a href="#cb37-537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co"># Keep largest outliers in either direction</span></span>
<span id="cb37-538"><a href="#cb37-538" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> <span class="fu">exp</span>(.fitted) <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-539"><a href="#cb37-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span><span class="st">`</span><span class="at">log_eas_3yr_01</span><span class="st">`</span>, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-540"><a href="#cb37-540" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-541"><a href="#cb37-541" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Log (EAs+0.1): Largest residuals, Imputed where missing"</span>) </span>
<span id="cb37-542"><a href="#cb37-542" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-543"><a href="#cb37-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-544"><a href="#cb37-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-545"><a href="#cb37-545" aria-hidden="true" tabindex="-1"></a>This model appears to be making more reasonable predictions; it is not predicting, e.g., hundreds of EAs in Barbados.</span>
<span id="cb37-546"><a href="#cb37-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-547"><a href="#cb37-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-548"><a href="#cb37-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-549"><a href="#cb37-549" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exponential (Quasi-Poisson)</span></span>
<span id="cb37-550"><a href="#cb37-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-551"><a href="#cb37-551" aria-hidden="true" tabindex="-1"></a>Exponential models are similar in interpretation to log-log models but are often seen as preferable. </span>
<span id="cb37-552"><a href="#cb37-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-553"><a href="#cb37-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_ea_qp_plot}</span></span>
<span id="cb37-554"><a href="#cb37-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-555"><a href="#cb37-555" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-556"><a href="#cb37-556" aria-hidden="true" tabindex="-1"></a>ea_dev_qp <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span>  </span>
<span id="cb37-557"><a href="#cb37-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-558"><a href="#cb37-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-559"><a href="#cb37-559" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-560"><a href="#cb37-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-561"><a href="#cb37-561" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-562"><a href="#cb37-562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP model - EAs: predicted, actual, no imputation"</span>) </span>
<span id="cb37-563"><a href="#cb37-563" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-564"><a href="#cb37-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-565"><a href="#cb37-565" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-566"><a href="#cb37-566" aria-hidden="true" tabindex="-1"></a>ea_dev_qp_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span> </span>
<span id="cb37-567"><a href="#cb37-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-568"><a href="#cb37-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>eas_3yr_avg, <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-569"><a href="#cb37-569" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-570"><a href="#cb37-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-571"><a href="#cb37-571" aria-hidden="true" tabindex="-1"></a>    devplotopts <span class="sc">+</span></span>
<span id="cb37-572"><a href="#cb37-572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP - EAs: Predicted, actual, Imputed where missing"</span>) </span>
<span id="cb37-573"><a href="#cb37-573" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-574"><a href="#cb37-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-575"><a href="#cb37-575" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-576"><a href="#cb37-576" aria-hidden="true" tabindex="-1"></a>ea_outliers_qp <span class="ot">&lt;-</span> eas_by_country_all_m <span class="sc">%&gt;%</span></span>
<span id="cb37-577"><a href="#cb37-577" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn) <span class="sc">%&gt;%</span> </span>
<span id="cb37-578"><a href="#cb37-578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb37-579"><a href="#cb37-579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> pred_psn <span class="sc">&lt;</span>minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-580"><a href="#cb37-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-581"><a href="#cb37-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-582"><a href="#cb37-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-583"><a href="#cb37-583" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-584"><a href="#cb37-584" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-585"><a href="#cb37-585" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP = EAs: Largest residuals, no imputation"</span>) </span>
<span id="cb37-586"><a href="#cb37-586" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-587"><a href="#cb37-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-588"><a href="#cb37-588" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-589"><a href="#cb37-589" aria-hidden="true" tabindex="-1"></a>ea_outliers_qp_i <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span></span>
<span id="cb37-590"><a href="#cb37-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn_i) <span class="sc">%&gt;%</span> </span>
<span id="cb37-591"><a href="#cb37-591" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span> <span class="co">#keep largest outliers in either direction</span></span>
<span id="cb37-592"><a href="#cb37-592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(eas_3yr_avg<span class="sc">&lt;</span>minEA_threshold <span class="sc">&amp;</span> pred_psn <span class="sc">&lt;</span> minEA_threshold)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-593"><a href="#cb37-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-594"><a href="#cb37-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>pred_psn_i, <span class="at">y=</span>(eas_3yr_avg), <span class="at">color=</span>ef_epi_19_adj) <span class="sc">+</span></span>
<span id="cb37-595"><a href="#cb37-595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span>  </span>
<span id="cb37-596"><a href="#cb37-596" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log2'</span>) <span class="sc">+</span></span>
<span id="cb37-597"><a href="#cb37-597" aria-hidden="true" tabindex="-1"></a>   devplotopts <span class="sc">+</span></span>
<span id="cb37-598"><a href="#cb37-598" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"QP - EAs: Top 5% largest residuals, Imputed where missing"</span>) </span>
<span id="cb37-599"><a href="#cb37-599" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-600"><a href="#cb37-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-601"><a href="#cb37-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-602"><a href="#cb37-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-603"><a href="#cb37-603" aria-hidden="true" tabindex="-1"></a>Note that in the chart above, the 'top and bottom 20% of outliers' includes some fairly small outliers. For example, there are some large countries with small residuals listed below that are nonetheess among those with the largest residuals. </span>
<span id="cb37-604"><a href="#cb37-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-605"><a href="#cb37-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{r usoutlier}</span></span>
<span id="cb37-606"><a href="#cb37-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-607"><a href="#cb37-607" aria-hidden="true" tabindex="-1"></a>eas_by_country_all_m_i <span class="sc">%&gt;%</span> </span>
<span id="cb37-608"><a href="#cb37-608" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">.resid =</span>  eas_3yr_avg <span class="sc">-</span> pred_psn_i)  <span class="sc">%&gt;%</span> </span>
<span id="cb37-609"><a href="#cb37-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid_filter</span>(threshold_low, threshold_high) <span class="sc">%&gt;%</span></span>
<span id="cb37-610"><a href="#cb37-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(.resid)<span class="sc">&lt;</span><span class="dv">12</span> <span class="sc">&amp;</span> population_3yr_avg<span class="sc">&gt;</span><span class="dv">60</span><span class="sc">*</span><span class="dv">1000</span><span class="sc">*</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-611"><a href="#cb37-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>population_3yr_avg) <span class="sc">%&gt;%</span> </span>
<span id="cb37-612"><a href="#cb37-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, population_3yr_avg, eas_3yr_avg, pred_psn_i, .resid )</span>
<span id="cb37-613"><a href="#cb37-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-614"><a href="#cb37-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-615"><a href="#cb37-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-616"><a href="#cb37-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-617"><a href="#cb37-617" aria-hidden="true" tabindex="-1"></a><span class="fu">## Table of residuals</span></span>
<span id="cb37-618"><a href="#cb37-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-619"><a href="#cb37-619" aria-hidden="true" tabindex="-1"></a>Below, a sortable table of residuals from each of the models, by country. (Along with population, EAs and EAs per million, and predicted EAS-per-capita from thethe per-capita model with imputation.)</span>
<span id="cb37-620"><a href="#cb37-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-621"><a href="#cb37-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tabresid}</span></span>
<span id="cb37-622"><a href="#cb37-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-623"><a href="#cb37-623" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb37-624"><a href="#cb37-624" aria-hidden="true" tabindex="-1"></a>  eas_v_predicted <span class="ot">&lt;-</span> eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb37-625"><a href="#cb37-625" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-626"><a href="#cb37-626" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_linear =</span> eas_3yr_avg <span class="sc">-</span> pred_linear,</span>
<span id="cb37-627"><a href="#cb37-627" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_linear_i =</span> eas_3yr_avg <span class="sc">-</span> pred_linear_i,</span>
<span id="cb37-628"><a href="#cb37-628" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_per100k =</span> easpercap_per100k <span class="sc">-</span> pred_eapercap,</span>
<span id="cb37-629"><a href="#cb37-629" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_per100k_i =</span> easpercap_per100k <span class="sc">-</span> pred_eapercap_i,</span>
<span id="cb37-630"><a href="#cb37-630" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_log_exp  =</span> eas_3yr_avg <span class="sc">-</span> <span class="fu">exp</span>(pred_log_ea),</span>
<span id="cb37-631"><a href="#cb37-631" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_log_exp_i  =</span> eas_3yr_avg <span class="sc">-</span> <span class="fu">exp</span>(pred_log_ea_i),</span>
<span id="cb37-632"><a href="#cb37-632" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_psn =</span> eas_3yr_avg <span class="sc">-</span> pred_psn,</span>
<span id="cb37-633"><a href="#cb37-633" aria-hidden="true" tabindex="-1"></a>      <span class="at">resid_psn_i =</span> eas_3yr_avg <span class="sc">-</span> pred_psn_i</span>
<span id="cb37-634"><a href="#cb37-634" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-635"><a href="#cb37-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(is.numeric, round, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-636"><a href="#cb37-636" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(country, population_3yr_avg, eas_3yr_avg, easpercap_permil, pred_eapercap_i, <span class="fu">starts_with</span>(<span class="st">"resid_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-637"><a href="#cb37-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">class =</span> <span class="st">'cell-border stripe'</span>)</span>
<span id="cb37-638"><a href="#cb37-638" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-639"><a href="#cb37-639" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-640"><a href="#cb37-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-641"><a href="#cb37-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-642"><a href="#cb37-642" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exporting all data (and model results) to git and Gsheets </span></span>
<span id="cb37-643"><a href="#cb37-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-644"><a href="#cb37-644" aria-hidden="true" tabindex="-1"></a>As RData, csv in the Github repo</span>
<span id="cb37-645"><a href="#cb37-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-646"><a href="#cb37-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r saveraw}</span></span>
<span id="cb37-647"><a href="#cb37-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-648"><a href="#cb37-648" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(eas_by_country_all_m, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_no_imputation.RData"</span>))</span>
<span id="cb37-649"><a href="#cb37-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-650"><a href="#cb37-650" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(eas_by_country_all_m_i, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_missings_imputed.RData"</span>))</span>
<span id="cb37-651"><a href="#cb37-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-652"><a href="#cb37-652" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(eas_by_country_all_m, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_no_imputation.csv"</span>))</span>
<span id="cb37-653"><a href="#cb37-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-654"><a href="#cb37-654" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv2</span>(eas_by_country_all_m_i, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"supplementary"</span>, <span class="st">"eas_by_country_features_predictions_missings_imputed.csv"</span>))</span>
<span id="cb37-655"><a href="#cb37-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-656"><a href="#cb37-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-657"><a href="#cb37-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-658"><a href="#cb37-658" aria-hidden="true" tabindex="-1"></a>Exporting the data and predictions to the Gsheet <span class="co">[</span><span class="ot">HERE</span><span class="co">](https://docs.google.com/spreadsheets/d/1OcxxMTjMPT1gg2w47h9ADn_eLDn_QcvCjMKdEBDZKFc/edit#gid=325316997)</span></span>
<span id="cb37-659"><a href="#cb37-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-660"><a href="#cb37-660" aria-hidden="true" tabindex="-1"></a>Unfortunately, it makes a new sheet each time; need to find a fix for this!  Thus the code below is set to not be run automatically.</span>
<span id="cb37-661"><a href="#cb37-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-662"><a href="#cb37-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb37-663"><a href="#cb37-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-664"><a href="#cb37-664" aria-hidden="true" tabindex="-1"></a><span class="co">#Need authorisation to write to RP drive</span></span>
<span id="cb37-665"><a href="#cb37-665" aria-hidden="true" tabindex="-1"></a><span class="fu">gs4_auth</span>(<span class="at">scopes =</span> <span class="st">"https://www.googleapis.com/auth/drive"</span>,  <span class="at">email =</span> <span class="st">"dreinstein@rethinkpriorities.org"</span>)</span>
<span id="cb37-666"><a href="#cb37-666" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-667"><a href="#cb37-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-668"><a href="#cb37-668" aria-hidden="true" tabindex="-1"></a>(eas_gsheet <span class="ot">&lt;-</span> <span class="fu">gs4_create</span>(<span class="st">"EAs_by_country_rich_data_predictions"</span>,</span>
<span id="cb37-669"><a href="#cb37-669" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheets =</span> <span class="fu">list</span>(</span>
<span id="cb37-670"><a href="#cb37-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">with_imputation =</span></span>
<span id="cb37-671"><a href="#cb37-671" aria-hidden="true" tabindex="-1"></a>      eas_by_country_all_m_i <span class="sc">%&gt;%</span>  </span>
<span id="cb37-672"><a href="#cb37-672" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.infinite</span>(.), <span class="dv">1</span>)), </span>
<span id="cb37-673"><a href="#cb37-673" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_imputation =</span> eas_by_country_all_m <span class="sc">%&gt;%</span> </span>
<span id="cb37-674"><a href="#cb37-674" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.infinite</span>(.), <span class="dv">1</span>))</span>
<span id="cb37-675"><a href="#cb37-675" aria-hidden="true" tabindex="-1"></a>    )))</span>
<span id="cb37-676"><a href="#cb37-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-677"><a href="#cb37-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->


</body></html>